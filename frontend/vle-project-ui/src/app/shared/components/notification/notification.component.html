<div id="notificationDropdownContainer" class="nav-item dropdown">
    <a class="nav-link notification-bell" role="button" [attr.aria-expanded]="isNotificationOpen" (click)="toggleDropdown($event)"
        [attr.aria-label]="'Notifications'">
        <i class="bi bi-bell-fill" aria-hidden="true"></i>
        <span *ngIf="unreadCount > 0" class="notification-badge"
            [attr.aria-label]="unreadCount + ' unread notifications'">
            {{ unreadCount > 99 ? '99+' : unreadCount }}
        </span>
    </a>

    <div class="dropdown-menu dropdown-menu-end notification-dropdown" [class.show]="isNotificationOpen">
        <div class="notification-header">
            <h5>Notifications</h5>
            <div class="notification-actions">
                <button class="btn btn-sm btn-link" (click)="markAllAsRead()" title="Mark all as read">Mark all
                    read</button>
                <button class="btn btn-sm btn-link" (click)="clearAll()" title="Clear all notifications">Clear
                    all</button>
            </div>
        </div>

        <div class="notification-body">
            <ng-container *ngIf="(notifications$ | async)?.length; else noNotifications">
                <div *ngFor="let notification of notifications$ | async" class="notification-item"
                    [class.unread]="!notification.isRead" 
                    [class.clickable]="!!notification.moduleId"
                    [class.admin-notification]="notification.notificationType === 'Admin'"
                    (click)="navigateToModule(notification, $event)">
                    <div class="notification-icon" *ngIf="notification.notificationType === 'Admin'">
                        <i class="bi bi-envelope-exclamation-fill"></i>
                    </div>
                    <div class="notification-icon" *ngIf="notification.notificationType === 'Grade'">
                        <i class="bi bi-clipboard-check-fill"></i>
                    </div>
                    <div class="notification-content">
                        <p>
                            <span *ngIf="notification.notificationType === 'Admin'" class="badge bg-theme">Admin</span>
                            {{ notification.message }}
                        </p>
                        <small class="notification-time">
                            <span *ngIf="notification.moduleTitle" class="module-name">
                                {{ notification.moduleTitle }} &bull; 
                            </span>
                            {{ formatTimeAgo(notification.createdAt) }}
                        </small>
                    </div>
                    <div class="notification-actions">
                        <button *ngIf="!notification.isRead" class="btn btn-sm mark-read-btn"
                            (click)="markAsRead(notification, $event)" title="Mark as read">
                            <i class="bi bi-check2"></i>
                        </button>
                        
                        <button class="btn btn-sm delete-btn"
                            (click)="deleteNotification(notification, $event)" title="Delete notification">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </ng-container>

            <ng-template #noNotifications>
                <div class="no-notifications">
                    <i class="bi bi-bell-slash"></i>
                    <p>No notifications</p>
                </div>
            </ng-template>
        </div>
    </div>
</div>