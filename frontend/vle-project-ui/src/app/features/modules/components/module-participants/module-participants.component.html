<div class="container mt-5 p-0">
    <h4 class="mb-3">Module Participants</h4>

    <div *ngIf="isLoadingParticipants" class="spinner-container m-5">
        <mat-spinner [diameter]="50"></mat-spinner>
    </div>

    <div *ngIf="!isLoadingParticipants && participants.length === 0" class="alert alert-info mt-3">
        No participants found.
    </div>

    <div *ngIf="!isLoadingParticipants && participants.length > 0">
        <div class="mb-4">
            <input type="text" class="form-control" placeholder="Search participants..." [(ngModel)]="searchQuery"
                (input)="onSearch()">
        </div>

        <div class="table-responsive mt-3">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th *ngIf="(isAdmin$ | async) || isModuleInstructor">ID</th>
                        <th>Last Name</th>
                        <th>First Name</th>
                        <th>Student Email</th>
                        <th>Gender</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let participant of displayedParticipants">
                        <td *ngIf="(isAdmin$ | async) || isModuleInstructor">{{ participant.userId }}</td>
                        <td>{{ participant.lastName }}</td>
                        <td>{{ participant.firstName }}</td>
                        <td>{{ participant.email }}</td>
                        <td>{{ participant.gender }}</td>
                    </tr>
                </tbody>
            </table>

            <mat-paginator [length]="filteredParticipants.length" [pageSize]="pageSize"
                [pageSizeOptions]="pageSizeOptions" [pageIndex]="pageIndex" (page)="onPageChange($event)"
                aria-label="Select page" class="mat-elevation-z0">
            </mat-paginator>
        </div>
    </div>

    <div class="d-flex flex-column flex-md-row justify-content-between gap-2 mt-3">
        <button class="btn btn-secondary w-sm-100 order-2 order-md-1" (click)="onBackToModuleDetail()">
            <i class="bi bi-arrow-left me-1"></i>
            Back to Module
        </button>
        
        <button class="btn btn-primary w-sm-100 order-1 order-md-2" 
            (click)="downloadParticipants()"
            *ngIf="participants.length > 0 && ((isAdmin$ | async) || isModuleInstructor)">
                <i class="bi bi-file-earmark-spreadsheet me-1"></i>
                Export CSV
        </button>
    </div>
</div>